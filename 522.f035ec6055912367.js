"use strict";(self.webpackChunkegret_angular_latest_test=self.webpackChunkegret_angular_latest_test||[]).push([[522],{76522:(rt,Z,o)=>{o.r(Z),o.d(Z,{AppChatsModule:()=>ct});var r=o(96814),Q=o(35420),l=o(56223),b=o(71088),v=o(32296),g=o(95195),U=o(30617),T=o(24516),L=o(59038),d=o(77988),p=o(32651),f=o(81274),t=o(65879),A=o(65619),y=o(78645),w=o(52572),Y=o(22096),m=o(94664),I=o(37398),N=o(69862);class x{}let C=(()=>{class n{constructor(e){this.http=e,this.onContactSelected=new A.X(null),this.onUserUpdated=new y.x,this.onChatSelected=new A.X(null),this.onChatsUpdated=new y.x}loadChatData(){return(0,w.a)(this.getAllContacts(),this.getAllChats(),this.getCurrentUser(),(e,a,i)=>{this.contacts=e,this.chats=a,this.user=i,this.onUserUpdated.next(i)})}getChatByContact(e){const a=this.user.chatInfo.find(i=>i.contactId===e);return this.collectionLoading=!0,a?this.getAllChats().pipe((0,m.w)(i=>{const c=i.find(u=>u.id===a.chatId),h=this.contacts.find(u=>u.id===e);return this.onChatSelected.next({chatCollection:c,contact:h}),this.collectionLoading=!1,(0,Y.of)(c)})):this.createChatCollection(e).pipe((0,m.w)(i=>this.getChatByContact(e)))}createChatCollection(e){const a=this.contacts.find(u=>u.id===e),i=(1e9*Math.random()).toString(),c={id:i,chats:[]},h={chatId:i,lastChatTime:new Date,contactId:a.id,contactName:a.name,unread:null};return this.http.post("api/chat-collections",{...c}).pipe((0,m.w)(u=>(this.user.chatInfo.push(h),this.updateUser(this.user).pipe((0,m.w)(ht=>this.getCurrentUser().pipe((0,I.U)(O=>{this.user=O,this.onUserUpdated.next(O)})))))))}getAllContacts(){return this.http.get("api/contacts")}getAllChats(){return this.http.get("api/chat-collections")}getCurrentUser(){return this.http.get("api/chat-user").pipe((0,I.U)(e=>e[0]))}updateUser(e){return this.http.put(`api/chat-user/${e.id}`,{...e})}updateChats(e,a){return this.http.put("api/chat-collections",{id:e,chats:a})}autoReply(e){setTimeout(()=>{this.onChatsUpdated.next(e)},1500)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(N.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();var _=o(26385),J=o(66278),B=o(83450);const F=function(n){return{online:n}};function q(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",8),t.NdJ("click",function(){const c=t.CHM(e).$implicit,h=t.oxw();return t.KtG(h.getChatByContact(c.contactId))}),t.TgZ(1,"a",9),t.ALo(2,"getValueByKey"),t._UZ(3,"img",2),t.ALo(4,"getValueByKey"),t._UZ(5,"span",3),t.qZA(),t.TgZ(6,"div")(7,"h6",10),t._uU(8),t.qZA(),t.TgZ(9,"p",11),t._uU(10),t.ALo(11,"date"),t.qZA()()()}if(2&n){const e=s.$implicit,a=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(14,F,"online"===t.Dn7(2,4,a.contacts,e.contactId,"status"))),t.xp6(2),t.Q6J("src",t.Dn7(4,8,a.contacts,e.contactId,"avatar"),t.LSH),t.xp6(5),t.Oqu(e.contactName),t.xp6(2),t.Oqu(t.lcZ(11,12,e.lastChatTime))}}function D(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",8),t.NdJ("click",function(){const c=t.CHM(e).$implicit,h=t.oxw();return t.KtG(h.getChatByContact(c.id))}),t.TgZ(1,"a",9),t._UZ(2,"img",2)(3,"span",12),t.qZA(),t.TgZ(4,"h6",13),t._uU(5),t.qZA()()}if(2&n){const e=s.$implicit;t.xp6(1),t.Q6J("ngClass",t.VKq(3,F,"online"===e.status)),t.xp6(1),t.Q6J("src",e.avatar,t.LSH),t.xp6(3),t.Oqu(e.name)}}let H=(()=>{class n{constructor(e,a){this.chatService=e,this.cdr=a,this.isSidenavOpen=!0,this.currentUser=new x}ngOnInit(){this.userUpdateSub=this.chatService.onUserUpdated.subscribe(e=>{this.currentUser=e}),this.loadDataSub=this.chatService.loadChatData().subscribe(e=>{this.currentUser=this.chatService.user,this.contacts=this.chatService.contacts,this.cdr.markForCheck()})}ngOnDestroy(){this.userUpdateSub&&this.userUpdateSub.unsubscribe(),this.loadDataSub&&this.loadDataSub.unsubscribe()}getChatByContact(e){this.chatService.getChatByContact(e).subscribe(a=>{},a=>{console.log(a)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(C),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-left-sidenav"]],decls:12,vars:4,consts:[["color","primary",1,"chat-sidebar-toolbar"],["href","",1,"toolbar-avatar","online"],["alt","",3,"src"],[1,"status-dot","mat-bg-primary"],[1,"m-0","pl-4","font-normal","fz-1"],[1,"chat-sidebar-scroll",3,"perfectScrollbar"],["role","list",1,"inbox-nav-list"],["class","flex p-4 items-center cursor-pointer hover:bg-slate-100",3,"click",4,"ngFor","ngForOf"],[1,"flex","p-4","items-center","cursor-pointer","hover:bg-slate-100",3,"click"],["mat-list-avatar","",1,"toolbar-avatar","mr-2","rtl:ml-2",3,"ngClass"],["matLine","",1,"mb-1"],["matLine","",1,"text-muted","mb-0"],[1,"status-dot"],["matLine","",1,"mb-0"]],template:function(e,a){1&e&&(t.TgZ(0,"mat-toolbar",0)(1,"a",1),t._UZ(2,"img",2)(3,"span",3),t.qZA(),t.TgZ(4,"h6",4),t._uU(5),t.qZA()(),t.TgZ(6,"div",5)(7,"div",6),t.YNc(8,q,12,16,"div",7),t.qZA(),t._UZ(9,"mat-divider"),t.TgZ(10,"div",6),t.YNc(11,D,6,5,"div",7),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("src",a.currentUser.avatar,t.LSH),t.xp6(3),t.Oqu(a.currentUser.name),t.xp6(3),t.Q6J("ngForOf",null==a.currentUser?null:a.currentUser.chatInfo),t.xp6(3),t.Q6J("ngForOf",a.contacts))},dependencies:[r.mk,r.sg,_.d,f.Ye,J.$,r.uU,B.X]}),n})();var M=o(68153),G=o(64170),K=o(13471);const j=["msgForm"],$=["msgInput"],S=function(n){return{online:n}};function R(n,s){if(1&n&&(t.TgZ(0,"div",10)(1,"a",11),t._UZ(2,"img",12)(3,"span",13),t.qZA(),t.TgZ(4,"div",14)(5,"h6",15),t._uU(6),t.qZA()()()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(3,S,"online"===e.activeContact.status)),t.xp6(1),t.Q6J("src",e.activeContact.avatar,t.LSH),t.xp6(4),t.Oqu(e.activeContact.name)}}function V(n,s){if(1&n&&(t.TgZ(0,"a",30),t._UZ(1,"img",31)(2,"span",13),t.qZA()),2&n){const e=t.oxw(3);t.Q6J("ngClass",t.VKq(3,S,"online"===e.user.status)),t.xp6(1),t.Q6J("src",null==e.user?null:e.user.avatar,t.LSH)("alt",null==e.user?null:e.user.name)}}function X(n,s){if(1&n&&(t.TgZ(0,"a",30),t._UZ(1,"img",31)(2,"span",13),t.qZA()),2&n){const e=t.oxw(3);t.Q6J("ngClass",t.VKq(3,S,"online"===e.activeContact.status)),t.xp6(1),t.Q6J("src",null==e.activeContact?null:e.activeContact.avatar,t.LSH)("alt",null==e.activeContact?null:e.activeContact.name)}}function z(n,s){if(1&n&&(t.TgZ(0,"h5",32),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.Oqu(null==e.activeContact?null:e.activeContact.name)}}function k(n,s){if(1&n&&(t.TgZ(0,"h5",32),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.Oqu(null==e.user?null:e.user.name)}}const E=function(n,s){return{sender:n,me:s}};function W(n,s){if(1&n&&(t.TgZ(0,"div",25),t.YNc(1,V,3,5,"a",26),t.YNc(2,X,3,5,"a",26),t.TgZ(3,"div"),t.YNc(4,z,2,1,"h5",27),t.YNc(5,k,2,1,"h5",27),t.TgZ(6,"div",28),t._uU(7),t.qZA(),t.TgZ(8,"p",29),t._uU(9),t.ALo(10,"relativeTime"),t.qZA()()()),2&n){const e=s.$implicit,a=t.oxw(2);t.Q6J("ngClass",t.WLB(9,E,e.contactId===a.activeContact.id,e.contactId!==a.activeContact.id)),t.xp6(1),t.Q6J("ngIf",e.contactId!==a.activeContact.id),t.xp6(1),t.Q6J("ngIf",e.contactId===a.activeContact.id),t.xp6(2),t.Q6J("ngIf",e.contactId===a.activeContact.id),t.xp6(1),t.Q6J("ngIf",e.contactId!==a.activeContact.id),t.xp6(2),t.hij(" ",e.text," "),t.xp6(2),t.Oqu(t.lcZ(10,7,e.time))}}function P(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"div",16),t.YNc(2,W,11,12,"div",17),t.qZA(),t._UZ(3,"mat-divider"),t.TgZ(4,"div",18)(5,"form",19,20),t.NdJ("ngSubmit",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.sendMessage(i))})("keydown.enter",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.sendMessage(i))}),t.TgZ(7,"mat-form-field",21),t._UZ(8,"textarea",22,23),t.qZA(),t.TgZ(10,"button",24)(11,"mat-icon"),t._uU(12,"send"),t.qZA()()()()()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngForOf",null==e.chatCollection?null:e.chatCollection.chats)}}function tt(n,s){1&n&&(t.TgZ(0,"div",33)(1,"div",34)(2,"div",35),t._UZ(3,"div",36)(4,"div",37),t.qZA()()())}const et=function(){return{height:"220px",width:"220px",borderRadius:"50%"}},nt=function(){return{height:"60px",width:"60px"}};function at(n,s){1&n&&(t.TgZ(0,"div",38)(1,"mat-card",39)(2,"mat-icon",40),t._uU(3,"chat"),t.qZA()(),t.TgZ(4,"h6"),t._uU(5,"Select a contact!"),t.qZA()()),2&n&&(t.xp6(1),t.Q6J("ngStyle",t.DdM(2,et)),t.xp6(1),t.Q6J("ngStyle",t.DdM(3,nt)))}let it=(()=>{class n{constructor(e,a){this.chatService=e,this.cdr=a,this.user=new x,this.activeContact=new x}ngOnInit(){this.userUpdateSub=this.chatService.onUserUpdated.subscribe(e=>{this.user=e,this.cdr.markForCheck()}),this.chatSelectSub=this.chatService.onChatSelected.subscribe(e=>{e&&(this.chatCollection=e.chatCollection,this.activeContact=e.contact,this.initMsgForm(),this.cdr.markForCheck())}),this.chatUpdateSub=this.chatService.onChatsUpdated.subscribe(e=>{this.chatCollection.chats.push(e),this.scrollToBottom(),this.cdr.markForCheck()})}ngOnDestroy(){this.userUpdateSub&&this.userUpdateSub.unsubscribe(),this.chatSelectSub&&this.chatSelectSub.unsubscribe(),this.chatUpdateSub&&this.chatUpdateSub.unsubscribe()}sendMessage(e){if(!this.msgForm.form.value.message||!this.msgForm.form.value.message.trim().length)return;const a={contactId:this.chatService.user.id,text:this.msgForm.form.value.message,time:(new Date).toISOString()};this.chatCollection.chats.push(a),this.chatService.updateChats(this.chatCollection.id,[...this.chatCollection.chats]).subscribe(i=>{this.initMsgForm(),this.cdr.markForCheck()}),this.chatService.autoReply({contactId:this.activeContact.id,text:`Hi, I'm ${this.activeContact.name}. Your imaginary friend.`,time:(new Date).toISOString()})}initMsgForm(){setTimeout(()=>{this.msgForm&&this.msgForm.reset(),this.msgInput&&this.msgInput.first&&this.msgInput.first.nativeElement.focus(),this.scrollToBottom()})}scrollToBottom(){setTimeout(()=>{this.psContainer&&this.psContainer.update(),this.psContainer&&this.psContainer.scrollToBottom(0,400)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(C),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-contents"]],viewQuery:function(e,a){if(1&e&&(t.Gf(M.$V,5),t.Gf(j,5),t.Gf($,5)),2&e){let i;t.iGM(i=t.CRH())&&(a.psContainer=i.first),t.iGM(i=t.CRH())&&(a.msgForm=i.first),t.iGM(i=t.CRH())&&(a.msgInput=i)}},inputs:{matSidenav:"matSidenav"},decls:26,vars:9,consts:[["color","primary",1,"chat-toolbar"],["mat-icon-button","",1,"mr-4","rtl:ml-4",3,"click"],["class","active-chat-user flex items-center justify-start",4,"ngIf"],[1,"flex-grow"],["mat-icon-button","",1,"topbar-button-right","hidden-on-open",3,"matMenuTriggerFor"],["toolbarDDMenu","matMenu"],["mat-menu-item",""],[4,"ngIf"],["class","chat-intro",4,"ngIf"],["class","chat-intro !flex flex-col justify-center items-center",4,"ngIf"],[1,"active-chat-user","flex","items-center","justify-start"],[1,"toolbar-avatar","mr-4","rtl:ml-4",3,"ngClass"],["alt","",3,"src"],[1,"status-dot"],[1,"flex","flex-col"],[1,"m-0","font-normal","fz-1"],[1,"conversations-hold",3,"perfectScrollbar"],["class","single-conversation flex flex-row",3,"ngClass",4,"ngFor","ngForOf"],[1,"chat-input-actions"],[1,"inputForm","flex","flex-row",3,"ngSubmit","keydown.enter"],["msgForm","ngForm"],[1,"full-width","mr-4","rtl:ml-4"],["matInput","","required","","ngModel","","placeholder","Type your message","name","message","value","",1,"inputText"],["msgInput",""],["mat-fab","","color","primary","type","submit"],[1,"single-conversation","flex","flex-row",3,"ngClass"],["href","","class","toolbar-avatar",3,"ngClass",4,"ngIf"],["class","chat-username text-muted",4,"ngIf"],[1,"conversation-msg"],[1,"chat-date","text-muted"],["href","",1,"toolbar-avatar",3,"ngClass"],[3,"src","alt"],[1,"chat-username","text-muted"],[1,"chat-intro"],[1,"chat-loader"],[1,"spinner"],[1,"double-bounce1","mat-bg-accent"],[1,"double-bounce2","mat-bg-primary"],[1,"chat-intro","!flex","flex-col","justify-center","items-center"],[1,"text-center","!flex","flex-row","justify-center","items-center",3,"ngStyle"],["color","primary",1,"text-60",3,"ngStyle"]],template:function(e,a){if(1&e&&(t.TgZ(0,"mat-toolbar",0)(1,"button",1),t.NdJ("click",function(){return a.matSidenav.toggle()}),t.TgZ(2,"mat-icon"),t._uU(3,"short_text"),t.qZA()(),t.YNc(4,R,7,5,"div",2),t._UZ(5,"span",3),t.TgZ(6,"button",4)(7,"mat-icon"),t._uU(8,"more_vert"),t.qZA()(),t.TgZ(9,"mat-menu",null,5)(11,"button",6)(12,"mat-icon"),t._uU(13,"account_circle"),t.qZA(),t._uU(14,"Contact info"),t.qZA(),t.TgZ(15,"button",6)(16,"mat-icon"),t._uU(17,"volume_mute"),t.qZA(),t._uU(18,"Mute"),t.qZA(),t.TgZ(19,"button",6)(20,"mat-icon"),t._uU(21,"delete"),t.qZA(),t._uU(22,"Clear chat"),t.qZA()()(),t.YNc(23,P,13,1,"div",7),t.YNc(24,tt,5,0,"div",8),t.YNc(25,at,6,4,"div",9)),2&e){const i=t.MAs(10);t.xp6(1),t.Udp("align-self","center"),t.xp6(3),t.Q6J("ngIf",a.activeContact.id),t.xp6(2),t.Udp("align-self","center"),t.Q6J("matMenuTriggerFor",i),t.xp6(17),t.Q6J("ngIf",a.chatCollection&&!a.chatService.collectionLoading),t.xp6(1),t.Q6J("ngIf",a.chatService.collectionLoading),t.xp6(1),t.Q6J("ngIf",!a.chatCollection&&!a.chatService.collectionLoading)}},dependencies:[r.mk,r.sg,r.O5,r.PC,l._Y,l.Fj,l.JJ,l.JL,l.Q7,l.On,l.F,d.VK,d.OP,d.p6,T.Nt,G.KE,U.Hw,v.RK,v.cs,_.d,f.Ye,g.a8,J.$,K.a]}),n})();const st=[{path:"",component:(()=>{class n{constructor(e,a){this.breakpointObserver=e,this.chatService=a,this.isSidenavOpen=!0,this.activeChatUser={name:"Gevorg Spartak",photo:"assets/images/face-2.jpg",isOnline:!0,lastMsg:"Hello!"},this.user=a.user}ngOnInit(){this.chatSideBarInit()}ngOnDestroy(){this.screenSizeWatcher&&this.screenSizeWatcher.unsubscribe()}changeActiveUser(e){this.activeChatUser=e}updateSidenav(){var e=this;setTimeout(()=>{e.isSidenavOpen=!e.isMobile,e.sideNav.mode=e.isMobile?"over":"side"})}chatSideBarInit(){this.isMobile=this.breakpointObserver.isMatched("(max-width: 959px)"),this.updateSidenav(),this.screenSizeWatcher=this.breakpointObserver.observe("(max-width: 959px)").subscribe(e=>{this.isMobile=e.matches,this.updateSidenav()})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(b.Yg),t.Y36(C))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chats"]],viewQuery:function(e,a){if(1&e&&t.Gf(p.JX,5),2&e){let i;t.iGM(i=t.CRH())&&(a.sideNav=i.first)}},decls:6,vars:2,consts:[[1,"p-0"],[1,"chat-container"],["mode","side",1,"chat-sidenav",3,"opened"],[1,"chats-wrap"],[3,"matSidenav"]],template:function(e,a){1&e&&(t.TgZ(0,"mat-card",0)(1,"mat-sidenav-container",1)(2,"mat-sidenav",2),t._UZ(3,"app-chat-left-sidenav"),t.qZA(),t.TgZ(4,"div",3),t._UZ(5,"app-chat-contents",4),t.qZA()()()),2&e&&(t.xp6(2),t.Q6J("opened",a.isSidenavOpen),t.xp6(3),t.Q6J("matSidenav",a.sideNav))},dependencies:[p.JX,p.TM,g.a8,H,it],changeDetection:0}),n})(),data:{title:"Chat"}}];var ot=o(45489);let ct=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[C],imports:[r.ez,l.u5,b.xu,p.SJ,d.Tx,T.c,U.Ps,v.ot,L.ie,f.g0,g.QW,M.Xd,ot.D,Q.Bz.forChild(st)]}),n})()}}]);